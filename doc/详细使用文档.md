# 控制栏阅读 - 详细使用文档

## 📖 目录

- [简介](#简介)
- [快速开始](#快速开始)
- [核心功能](#核心功能)
- [搜索跳转功能](#搜索跳转功能)
- [配置说明](#配置说明)
- [快捷键详解](#快捷键详解)
- [命令列表](#命令列表)
- [使用技巧](#使用技巧)
- [常见问题](#常见问题)

---

## 简介

**控制栏阅读** 是一个 VS Code 扩展插件，可以在状态栏中隐蔽地显示文本文件内容。支持真实内容/迷惑内容切换、分页阅读、多文件切换、内容搜索等功能，适合在状态栏中隐蔽地阅读文本内容。

### 主要特性

- ✅ **隐蔽显示**：默认显示迷惑性文案，按快捷键才显示真实内容
- ✅ **分页阅读**：支持长文本分页显示，可切换页码
- ✅ **多文件支持**：支持配置多个文件，可快速切换
- ✅ **内容搜索**：支持搜索内容并跳转到匹配位置
- ✅ **阅读缓存**：记住每个文件的阅读位置
- ✅ **自动监听**：文件变化时自动更新显示
- ✅ **Base64 加密**：支持读取 Base64 编码的文件内容

---

## 快速开始

### 安装方式

#### 方式一：从源码安装（开发模式）

1. **克隆或下载项目**
```bash
cd /path/to/ControlBarReading
```

2. **安装依赖**
```bash
npm install
```

3. **编译 TypeScript**
```bash
npm run compile
```

4. **运行调试**
   - 在 VS Code 中打开项目
   - 按 `F5` 启动调试
   - 在新打开的窗口中测试插件

#### 方式二：打包安装

1. **安装打包工具**
```bash
npm install -g @vscode/vsce
```

2. **打包插件**
```bash
npm run package
```

3. **安装 VSIX**
   - 在 VS Code 中按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）
   - 输入 `Extensions: Install from VSIX...`
   - 选择生成的 `.vsix` 文件

### 基本使用步骤

1. **创建文本文件**
   在工作区根目录创建 `secret.txt` 文件，写入要显示的内容

2. **配置文件路径**
   - 使用命令：`控制栏阅读: 配置文件路径`
   - 或编辑 `.vscode/settings.json`：
   ```json
   {
     "secretStatusBar.filePath": "${workspaceFolder}/secret.txt"
   }
   ```

3. **查看内容**
   - 默认状态栏显示迷惑性文案（如 "Ln 1, Col 1"）
   - 按 `Ctrl+Shift+T`（Mac: `Cmd+Shift+T`）切换显示真实内容
   - 点击状态栏图标可在输出面板查看完整内容

---

## 核心功能

### 1. 文件读取与显示

插件可以从指定的文本文件读取内容，并在状态栏中显示。

**支持的文件格式：**
- 纯文本文件（`.txt`）
- 支持 Base64 编码的文件（需启用加密选项）

**显示位置：**
- 状态栏右侧（默认位置）
- 输出面板（点击图标查看完整内容）

### 2. 显示模式切换

插件支持两种显示模式：

#### 迷惑内容模式（默认）
- 显示模拟 VS Code 状态栏信息的迷惑性文案
- 如："Ln 1, Col 1"、"UTF-8"、"Plain Text" 等
- 保持隐蔽性，不易被发现

#### 真实内容模式
- 显示文件的实际内容
- 按快捷键 `Ctrl+Shift+T` 切换
- 可以查看、阅读文件内容

**切换方式：**
- 快捷键：`Ctrl+Shift+T`（Mac: `Cmd+Shift+T`）
- 命令：`控制栏阅读: 切换显示模式`

### 3. 分页阅读

对于长文本文件，插件支持分页显示：

**功能特点：**
- 按字符数分页（默认每页 50 字符，可配置）
- 尽量在单词边界处断开，避免截断单词
- 支持页码切换（上一页/下一页）
- 可选显示页码信息（第几页/总页数）

**使用方法：**
1. 先切换到真实内容模式（`Ctrl+Shift+T`）
2. 使用快捷键切换页码：
   - `Ctrl+Up`（Mac: `Cmd+Up`）- 上一页
   - `Ctrl+Down`（Mac: `Cmd+Down`）- 下一页
3. 或使用命令：
   - `控制栏阅读: 上一页`
   - `控制栏阅读: 下一页`

### 4. 多文件支持

插件支持配置多个文件，可以快速切换：

**配置方式：**
```json
{
  "secretStatusBar.files": [
    "${workspaceFolder}/file1.txt",
    "${workspaceFolder}/file2.txt",
    "${workspaceFolder}/file3.txt"
  ]
}
```

**切换文件：**
- 命令：`控制栏阅读: 切换文件`
- 循环切换所有配置的文件
- 每个文件的阅读位置独立保存

### 5. 阅读缓存

插件会记住每个文件的阅读位置：

**功能特点：**
- 自动保存当前阅读的页码
- 下次打开文件时自动定位到上次阅读的位置
- 每个文件的阅读位置独立保存
- 支持多文件切换时保持各自的阅读位置

**启用/禁用：**
```json
{
  "secretStatusBar.enableCache": true  // 默认启用
}
```

### 6. 文件自动监听

插件会自动监听文件的变化：

**监听事件：**
- ✅ 文件修改：保存后自动更新状态栏
- ✅ 文件创建：自动加载新文件
- ⚠️ 文件删除：显示警告信息

**注意：**
- 文件必须保存后才会触发更新
- 如果自动更新失败，使用命令 `控制栏阅读: 重新加载文件`

---

## 搜索跳转功能

### 功能概述

搜索跳转功能允许您通过搜索关键词快速定位到内容中的特定位置，并自动跳转到对应的页面。

### 使用方法

#### 1. 打开搜索

**方式一：命令面板**
1. 按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）打开命令面板
2. 输入 `控制栏阅读: 搜索内容`
3. 按回车执行

**方式二：快捷键（可选）**
- 可以在 VS Code 快捷键设置中为 `secretStatusBar.search` 命令配置快捷键
- 建议使用：`Ctrl+Shift+F`（Mac: `Cmd+Shift+F`）

#### 2. 输入搜索关键词

在弹出的输入框中输入要搜索的内容：
- 支持普通文本搜索
- 不区分大小写
- 支持部分匹配

#### 3. 查看搜索结果

**单个匹配：**
- 如果只找到一个匹配，会自动跳转到该位置
- 显示提示信息："已跳转到第 X 页（共 Y 页）"

**多个匹配：**
- 如果找到多个匹配，会显示选择列表
- 每个选项显示：
  - **标签**：`第 X 页` - 匹配所在的页面
  - **描述**：匹配的上下文（前后各30字符）
  - **详情**：`匹配位置: X` - 在内容中的位置
- 使用上下箭头选择，回车确认跳转

### 搜索功能特点

1. **智能页面定位**
   - 自动计算匹配内容所在的页面
   - 考虑分页时的单词边界断开逻辑
   - 准确跳转到匹配位置

2. **上下文预览**
   - 显示匹配前后的内容（各30字符）
   - 帮助快速识别匹配位置
   - 显示省略号（`...`）表示内容被截断

3. **自动显示真实内容**
   - 搜索跳转时自动切换到真实内容模式
   - 无需手动切换显示模式

4. **结果数量限制**
   - 最多显示 100 个匹配结果
   - 避免大文件搜索时性能问题

5. **搜索范围**
   - 在整个文件内容中搜索
   - 使用与分页相同的文本清理逻辑
   - 保证搜索和显示的一致性

### 使用示例

#### 示例 1：搜索单个关键词

1. 打开搜索：`控制栏阅读: 搜索内容`
2. 输入关键词：`重要信息`
3. 如果只有一个匹配，自动跳转到该页面
4. 状态栏显示包含该关键词的页面内容

#### 示例 2：搜索多个匹配

1. 打开搜索：`控制栏阅读: 搜索内容`
2. 输入关键词：`项目`
3. 显示选择列表：
   ```
   第 1 页
   项目计划书的主要内容...
   匹配位置: 15

   第 3 页
   项目进度更新，当前项目...
   匹配位置: 142
   ```
4. 选择要跳转的位置，回车确认
5. 自动跳转到对应页面

#### 示例 3：搜索短语

1. 打开搜索：`控制栏阅读: 搜索内容`
2. 输入短语：`会议记录`
3. 搜索所有包含该短语的位置
4. 从列表中选择要查看的位置

### 搜索技巧

1. **使用具体关键词**
   - 使用更具体的关键词可以减少匹配数量
   - 例如：搜索 `会议记录 2024` 而不是只搜索 `会议`

2. **利用上下文预览**
   - 在选择列表中查看上下文预览
   - 帮助快速识别正确的匹配位置

3. **结合分页阅读**
   - 搜索跳转后，可以使用上下页快捷键继续阅读
   - 阅读位置会自动保存

4. **多文件搜索**
   - 搜索只在当前文件中进行
   - 切换文件后需要重新搜索

---

## 配置说明

### 配置方式

插件支持两种配置方式（优先级：JSON 配置文件 > VS Code 设置）：

1. **JSON 配置文件**：在工作区根目录创建 `secret-status-bar.config.json`
2. **VS Code 设置**：在 `.vscode/settings.json` 或用户设置中配置

### 配置项详解

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `secretStatusBar.filePath` | string | `"${workspaceFolder}/secret.txt"` | 要读取的文件路径（支持 `${workspaceFolder}` 变量） |
| `secretStatusBar.files` | string[] | `[]` | 文件列表（支持多个文件切换，支持 `${workspaceFolder}` 变量） |
| `secretStatusBar.enableEncryption` | boolean | `false` | 是否启用 Base64 加密 |
| `secretStatusBar.enableClickDialog` | boolean | `true` | 点击状态栏图标时是否显示对话框 |
| `secretStatusBar.icon` | string | `"$(circle-outline)"` | 状态栏图标（VS Code 图标 ID） |
| `secretStatusBar.maxDisplayLength` | number | `50` | 状态栏最大显示字符数（超过会截断） |
| `secretStatusBar.pageSize` | number | `50` | 每页显示的字符数（用于分页功能） |
| `secretStatusBar.enableCache` | boolean | `true` | 是否启用阅读缓存（记住阅读位置） |
| `secretStatusBar.showPageInfo` | boolean | `false` | 是否在状态栏显示页码信息（第几页/总页数） |

### 配置文件示例

#### JSON 配置文件 (`secret-status-bar.config.json`)

```json
{
  "filePath": "${workspaceFolder}/secret.txt",
  "files": [
    "${workspaceFolder}/secret.txt",
    "${workspaceFolder}/another-secret.txt"
  ],
  "enableEncryption": false,
  "enableClickDialog": true,
  "icon": "$(circle-outline)",
  "maxDisplayLength": 50,
  "pageSize": 50,
  "enableCache": true,
  "showPageInfo": false
}
```

#### VS Code 设置 (`.vscode/settings.json`)

```json
{
  "secretStatusBar.filePath": "${workspaceFolder}/secret.txt",
  "secretStatusBar.files": [
    "${workspaceFolder}/secret.txt",
    "${workspaceFolder}/another-secret.txt"
  ],
  "secretStatusBar.enableEncryption": false,
  "secretStatusBar.enableClickDialog": true,
  "secretStatusBar.icon": "$(circle-outline)",
  "secretStatusBar.maxDisplayLength": 50,
  "secretStatusBar.pageSize": 50,
  "secretStatusBar.enableCache": true,
  "secretStatusBar.showPageInfo": false
}
```

### 常用图标

- `$(circle-outline)` - 圆圈轮廓（默认）
- `$(blank)` - 空白（最隐蔽）
- `$(eye)` - 眼睛
- `$(lock)` - 锁
- `$(key)` - 钥匙
- `$(shield)` - 盾牌

---

## 快捷键详解

### 默认快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Ctrl+Shift+T`<br>(Mac: `Cmd+Shift+T`) | 切换显示模式 | 在真实内容和迷惑内容之间切换 |
| `Ctrl+Up`<br>(Mac: `Cmd+Up`) | 上一页 | 根据显示模式执行不同功能 |
| `Ctrl+Down`<br>(Mac: `Cmd+Down`) | 下一页 | 根据显示模式执行不同功能 |

### 快捷键行为详解

#### 切换显示模式 (`Ctrl+Shift+T`)

- **功能**：在真实内容和迷惑内容之间切换
- **行为**：每次按下都会切换显示模式
- **适用场景**：查看真实内容时使用

#### 上下页快捷键 (`Ctrl+Up` / `Ctrl+Down`)

**重要：快捷键行为会根据显示模式自动切换！**

##### 显示迷惑信息时

- **行为**：执行原有的快捷键功能
  - `Ctrl+Up` → 执行 `cursorUp`（向上移动光标）
  - `Ctrl+Down` → 执行 `cursorDown`（向下移动光标）
- **目的**：不干扰正常的编辑操作
- **适用场景**：在编辑器中正常工作时，快捷键保持原有功能

##### 显示真实内容时

- **行为**：执行翻页功能
  - `Ctrl+Up` → 切换到上一页
  - `Ctrl+Down` → 切换到下一页
- **目的**：方便阅读和浏览内容
- **适用场景**：查看文件内容时，使用快捷键快速翻页

### 自定义快捷键

#### 方法一：使用命令配置

1. 使用命令：`控制栏阅读: 配置快捷键`
2. 选择要配置的快捷键
3. 在 VS Code 快捷键设置中配置

#### 方法二：手动配置

1. 按 `Ctrl+K Ctrl+S`（Mac: `Cmd+K Cmd+S`）打开快捷键设置
2. 搜索命令：
   - `secretStatusBar.toggleDisplay` - 切换显示模式
   - `secretStatusBar.previousPage` - 上一页
   - `secretStatusBar.nextPage` - 下一页
   - `secretStatusBar.search` - 搜索内容
3. 双击命令，设置自定义快捷键

### 快捷键使用流程

#### 场景 1：正常编辑时

1. 默认显示迷惑信息
2. 使用 `Ctrl+Up` / `Ctrl+Down` 正常移动光标
3. 快捷键执行原有功能，不影响编辑

#### 场景 2：查看内容时

1. 按 `Ctrl+Shift+T` 切换到真实内容模式
2. 使用 `Ctrl+Up` / `Ctrl+Down` 切换页码
3. 快捷键执行翻页功能，方便阅读
4. 再次按 `Ctrl+Shift+T` 切换回迷惑内容模式

---

## 命令列表

按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）打开命令面板，输入 `控制栏阅读:` 可查看所有命令。

### 文件操作

| 命令 | 说明 |
|------|------|
| `控制栏阅读: 显示隐藏内容` | 在输出面板显示完整内容 |
| `控制栏阅读: 重新加载文件` | 手动重新加载文件 |
| `控制栏阅读: 配置文件路径` | 交互式配置文件路径 |
| `控制栏阅读: 选择文件` | 通过文件选择器选择文件 |
| `控制栏阅读: 切换文件` | 切换到下一个文件（多文件模式） |

### 分页操作

| 命令 | 说明 |
|------|------|
| `控制栏阅读: 上一页` | 切换到上一页 |
| `控制栏阅读: 下一页` | 切换到下一页 |

**注意：** 上下页快捷键的行为会根据显示模式自动切换（见[快捷键详解](#快捷键详解)）

### 搜索功能

| 命令 | 说明 |
|------|------|
| `控制栏阅读: 搜索内容` | 搜索内容并跳转到匹配位置 |

**使用方法：**
1. 执行命令
2. 输入搜索关键词
3. 如果有多个匹配，从列表中选择
4. 自动跳转到对应页面

### 显示模式

| 命令 | 说明 |
|------|------|
| `控制栏阅读: 切换显示模式（Ctrl+Shift+T）` | 切换真实内容 ↔ 迷惑内容 |
| `控制栏阅读: 显示真实内容` | 显示真实内容 |
| `控制栏阅读: 显示迷惑内容` | 显示迷惑内容 |

### 设置相关

| 命令 | 说明 |
|------|------|
| `控制栏阅读: 打开设置界面` | 打开可视化设置界面 |
| `控制栏阅读: 配置快捷键` | 快速配置快捷键 |

---

## 使用技巧

### 技巧 1：最隐蔽模式

如果想更隐蔽：

1. **设置空白图标**
```json
{
  "secretStatusBar.icon": "$(blank)"
}
```

2. **默认显示迷惑内容**
   - 默认就是迷惑内容模式
   - 只有按快捷键才显示真实内容

3. **禁用点击对话框**
```json
{
  "secretStatusBar.enableClickDialog": false
}
```

### 技巧 2：使用加密

如果文件内容是 Base64 编码的：

1. 在设置中启用 `secretStatusBar.enableEncryption: true`
2. 将 Base64 编码的内容保存到文件
3. 插件会自动解码显示

**Base64 编码示例：**
```bash
# 使用命令行工具编码
echo "这是秘密" | base64
# 输出：6L+Z5piv5Yqg5LiL
```

### 技巧 3：多文件管理

配置多个文件，快速切换：

1. **配置文件列表**
```json
{
  "secretStatusBar.files": [
    "${workspaceFolder}/file1.txt",
    "${workspaceFolder}/file2.txt",
    "${workspaceFolder}/file3.txt"
  ]
}
```

2. **切换文件**
   - 使用命令 `控制栏阅读: 切换文件`
   - 循环切换所有文件

3. **阅读缓存**
   - 每个文件的阅读位置独立保存
   - 切换文件后会自动定位到上次阅读的位置

### 技巧 4：分页阅读

对于超长文本：

1. **设置每页字符数**
```json
{
  "secretStatusBar.pageSize": 50
}
```

2. **显示页码信息**
```json
{
  "secretStatusBar.showPageInfo": true
}
```

3. **切换页码**
   - 先按 `Ctrl+Shift+T` 显示真实内容
   - 然后按 `Ctrl+Up` / `Ctrl+Down` 切换页码

### 技巧 5：快速搜索定位

使用搜索功能快速定位内容：

1. **打开搜索**
   - 使用命令：`控制栏阅读: 搜索内容`
   - 或配置快捷键（如 `Ctrl+Shift+F`）

2. **输入关键词**
   - 使用具体的关键词减少匹配数量
   - 例如：搜索 `会议记录 2024` 而不是只搜索 `会议`

3. **选择匹配位置**
   - 如果有多个匹配，从列表中选择
   - 查看上下文预览帮助识别

4. **继续阅读**
   - 跳转后可以使用上下页快捷键继续阅读
   - 阅读位置会自动保存

### 技巧 6：结合使用

**完整阅读流程：**

1. 按 `Ctrl+Shift+T` 切换到真实内容模式
2. 使用 `Ctrl+Up` / `Ctrl+Down` 浏览内容
3. 需要查找特定内容时，使用搜索功能
4. 搜索跳转后继续使用上下页阅读
5. 阅读完成后，按 `Ctrl+Shift+T` 切换回迷惑内容模式

---

## 常见问题

### Q1: 状态栏没有显示图标？

**A:** 检查以下几点：
1. 文件路径是否正确
2. 文件是否存在
3. 查看 VS Code 的输出面板（选择 "控制栏阅读"）查看错误信息
4. 使用命令 `控制栏阅读: 重新加载文件`
5. 检查路径变量是否已替换（如 `${workspaceFolder}`）

### Q2: 文件更新后状态栏没有更新？

**A:** 
1. 确保文件已保存（`Ctrl+S`）
2. 手动触发：`控制栏阅读: 重新加载文件`
3. 检查文件监听器是否正常工作
4. 重启 VS Code

### Q3: 如何更改状态栏图标？

**A:** 在设置中修改 `secretStatusBar.icon` 配置项，使用 VS Code 内置的图标 ID。

### Q4: 如何切换显示模式？

**A:** 
- 按 `Ctrl+Shift+T`（Mac: `Cmd+Shift+T`）切换显示模式
- 或使用命令 `控制栏阅读: 切换显示模式`

### Q5: 如何切换页码？

**A:** 
1. 先按 `Ctrl+Shift+T` 显示真实内容
2. 然后按 `Ctrl+Up` / `Ctrl+Down` 切换页码
3. 注意：显示迷惑信息时，这些快捷键执行原有功能（移动光标）

### Q6: 搜索功能如何使用？

**A:**
1. 使用命令 `控制栏阅读: 搜索内容`
2. 输入搜索关键词
3. 如果有多个匹配，从列表中选择
4. 自动跳转到对应页面

### Q7: 搜索时显示"未找到匹配内容"？

**A:**
1. 检查搜索关键词是否正确
2. 确认文件内容已加载
3. 尝试使用不同的关键词
4. 检查文件内容是否包含该关键词

### Q8: 快捷键不生效？

**A:**
1. 检查快捷键是否被其他插件占用
2. 使用命令 `控制栏阅读: 配置快捷键` 检查配置
3. 在 VS Code 快捷键设置中查看冲突
4. 重新配置快捷键

### Q9: 显示迷惑信息时，上下页快捷键执行什么功能？

**A:**
- 显示迷惑信息时，`Ctrl+Up` / `Ctrl+Down` 执行原有功能（移动光标）
- 显示真实内容时，这些快捷键执行翻页功能
- 这是为了不干扰正常的编辑操作

### Q10: 配置文件不生效？

**A:**
1. 检查 JSON 配置文件格式是否正确
2. 确认配置文件在工作区根目录
3. 记住：JSON 配置文件优先级高于 VS Code 设置
4. 使用命令 `控制栏阅读: 打开设置界面` 查看当前配置

### Q11: 支持哪些文件格式？

**A:** 目前支持纯文本文件（`.txt`），内容会自动清理空白和换行。如果启用加密选项，支持 Base64 编码的文件。

### Q12: 如何禁用阅读缓存？

**A:** 在配置中设置 `secretStatusBar.enableCache: false`

---

## 更新日志

### v1.1.0（最新）

- ✅ 新增搜索跳转功能
  - 支持搜索内容并跳转到匹配位置
  - 支持多匹配结果选择
  - 自动显示真实内容
  - 智能页面定位

- ✅ 优化快捷键行为
  - 显示迷惑信息时，上下页快捷键执行原有功能
  - 显示真实内容时，上下页快捷键执行翻页功能
  - 不干扰正常的编辑操作

### v1.0.0

- ✅ 基础功能
  - 文件读取和显示
  - 显示模式切换
  - 分页阅读
  - 多文件支持
  - 阅读缓存
  - 文件自动监听

---

## 技术支持

如果遇到问题或有建议，请：

1. 查看输出面板（选择 "控制栏阅读" 通道）的错误信息
2. 检查配置文件格式是否正确
3. 查看本文档的[常见问题](#常见问题)部分
4. 提交 Issue 或 Pull Request

---

**祝您使用愉快！** 🎉

