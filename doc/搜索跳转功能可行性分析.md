# æœç´¢è·³è½¬åŠŸèƒ½å¯è¡Œæ€§åˆ†æ

## ğŸ“‹ åŠŸèƒ½éœ€æ±‚

1. **æœç´¢åŠŸèƒ½**ï¼šèƒ½å¤Ÿé€šè¿‡æ£€ç´¢çš„æ–‡æ¡ˆè¿›è¡Œè·³è½¬åˆ°é˜…è¯»å†…å®¹
2. **å¤šåŒ¹é…é€‰æ‹©**ï¼šå¦‚æœæœ‰å¤šä¸ªåŒ¹é…çš„æ®µè½åº”è¯¥æ”¯æŒé€‰æ‹©

## âœ… æŠ€æœ¯å¯è¡Œæ€§åˆ†æ

### 1. ç°æœ‰åŸºç¡€æ”¯æŒ

#### âœ… åˆ†é¡µç³»ç»Ÿå·²å®Œå–„
- `paginateContent()` å‡½æ•°å·²å®ç°å†…å®¹åˆ†é¡µ
- `currentPages` æ•°ç»„å­˜å‚¨æ‰€æœ‰é¡µé¢
- `currentPage` è·Ÿè¸ªå½“å‰é¡µç 
- `goToPreviousPage()` å’Œ `goToNextPage()` å·²å®ç°é¡µé¢è·³è½¬

#### âœ… VS Code API æ”¯æŒ
- `vscode.window.showInputBox()` - è¾“å…¥æœç´¢å…³é”®è¯ âœ…
- `vscode.window.showQuickPick()` - æ˜¾ç¤ºå¤šä¸ªåŒ¹é…ç»“æœä¾›é€‰æ‹© âœ…
- `vscode.window.showInformationMessage()` - æ˜¾ç¤ºæç¤ºä¿¡æ¯ âœ…

#### âœ… å†…å®¹å¤„ç†é€»è¾‘å·²ç»Ÿä¸€
- `cleanTextContent()` ç»Ÿä¸€å¤„ç†å†…å®¹æ¸…ç†
- æœç´¢å’Œåˆ†é¡µä½¿ç”¨ç›¸åŒçš„æ¸…ç†é€»è¾‘ï¼Œä¿è¯ä¸€è‡´æ€§

### 2. å®ç°æ–¹æ¡ˆ

#### æ–¹æ¡ˆæ¦‚è¿°

```
ç”¨æˆ·è§¦å‘æœç´¢å‘½ä»¤
  â†“
è¾“å…¥æœç´¢å…³é”®è¯
  â†“
åœ¨æ¸…ç†åçš„å†…å®¹ä¸­æœç´¢æ‰€æœ‰åŒ¹é…ä½ç½®
  â†“
è®¡ç®—æ¯ä¸ªåŒ¹é…æ‰€åœ¨çš„é¡µé¢
  â†“
å¦‚æœåªæœ‰1ä¸ªåŒ¹é… â†’ ç›´æ¥è·³è½¬
å¦‚æœæœ‰å¤šäº1ä¸ªåŒ¹é… â†’ æ˜¾ç¤ºé€‰æ‹©åˆ—è¡¨ â†’ ç”¨æˆ·é€‰æ‹© â†’ è·³è½¬
```

#### æ ¸å¿ƒå‡½æ•°è®¾è®¡

**1. æœç´¢åŒ¹é…å‡½æ•°**
```typescript
interface SearchMatch {
    index: number;        // åŒ¹é…ä½ç½®åœ¨æ¸…ç†åå†…å®¹ä¸­çš„ç´¢å¼•
    page: number;         // åŒ¹é…æ‰€åœ¨çš„é¡µé¢ï¼ˆ0-basedï¼‰
    context: string;      // åŒ¹é…ä¸Šä¸‹æ–‡ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
}

function searchContent(
    cleanedContent: string,
    searchText: string,
    pages: string[],
    pageSize: number
): SearchMatch[]
```

**2. è®¡ç®—é¡µé¢ä½ç½®å‡½æ•°**
```typescript
function calculatePageForPosition(
    position: number,
    pages: string[],
    cleanedContent: string
): number
```

**3. è·³è½¬åˆ°æŒ‡å®šé¡µé¢å‡½æ•°**
```typescript
async function jumpToPage(
    page: number,
    filePath: string,
    context: vscode.ExtensionContext
)
```

### 3. æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

#### æŒ‘æˆ˜1: é¡µé¢è¾¹ç•Œè®¡ç®—

**é—®é¢˜**ï¼šåˆ†é¡µæ—¶ä¼šåœ¨ç©ºæ ¼å¤„æ–­å¼€ï¼Œå®é™…é¡µé¢è¾¹ç•Œä¸æ˜¯ä¸¥æ ¼çš„ `pageSize` å€æ•°ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é‡å»ºé¡µé¢è¾¹ç•Œæ˜ å°„è¡¨
- è®°å½•æ¯ä¸ªé¡µé¢çš„èµ·å§‹å’Œç»“æŸä½ç½®
- æ ¹æ®åŒ¹é…ä½ç½®æŸ¥æ‰¾å¯¹åº”çš„é¡µé¢

```typescript
// æ„å»ºé¡µé¢è¾¹ç•Œæ˜ å°„
interface PageBoundary {
    start: number;
    end: number;
}

function buildPageBoundaries(
    pages: string[],
    cleanedContent: string
): PageBoundary[]
```

#### æŒ‘æˆ˜2: æœç´¢å†…å®¹ä¸æ˜¾ç¤ºå†…å®¹çš„ä¸€è‡´æ€§

**é—®é¢˜**ï¼šæœç´¢éœ€è¦åœ¨æ¸…ç†åçš„å†…å®¹ä¸­è¿›è¡Œï¼Œä½†ç”¨æˆ·çœ‹åˆ°çš„æ˜¯åˆ†é¡µåçš„å†…å®¹ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æœç´¢æ—¶ä½¿ç”¨ `cleanTextContent()` å¤„ç†åçš„å†…å®¹
- æ˜¾ç¤ºåŒ¹é…ç»“æœæ—¶ï¼Œä»åŸå§‹é¡µé¢å†…å®¹ä¸­æå–ä¸Šä¸‹æ–‡
- ä¿è¯æœç´¢é€»è¾‘ä¸åˆ†é¡µé€»è¾‘ä½¿ç”¨ç›¸åŒçš„æ¸…ç†å‡½æ•°

#### æŒ‘æˆ˜3: å¤šåŒ¹é…ç»“æœå±•ç¤º

**é—®é¢˜**ï¼šå¦‚ä½•æ¸…æ™°å±•ç¤ºå¤šä¸ªåŒ¹é…ç»“æœï¼Œè®©ç”¨æˆ·å®¹æ˜“é€‰æ‹©ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `showQuickPick()` æ˜¾ç¤ºåŒ¹é…åˆ—è¡¨
- æ¯ä¸ªé€‰é¡¹æ˜¾ç¤ºï¼š
  - åŒ¹é…çš„ä¸Šä¸‹æ–‡ï¼ˆå‰åå„20ä¸ªå­—ç¬¦ï¼‰
  - æ‰€åœ¨é¡µé¢ï¼ˆç¬¬Xé¡µ/å…±Yé¡µï¼‰
  - åŒ¹é…å…³é”®è¯é«˜äº®ï¼ˆå¯é€‰ï¼‰

```typescript
const items = matches.map((match, index) => ({
    label: `ç¬¬ ${match.page + 1} é¡µ`,
    description: match.context,
    detail: `ä½ç½®: ${match.index}`,
    match: match
}));
```

#### æŒ‘æˆ˜4: æ€§èƒ½ä¼˜åŒ–

**é—®é¢˜**ï¼šå¤§æ–‡ä»¶æœç´¢å¯èƒ½è¾ƒæ…¢ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é™åˆ¶æœç´¢ç»“æœæ•°é‡ï¼ˆå¦‚æœ€å¤š100ä¸ªï¼‰
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¼˜åŒ–æœç´¢
- å¼‚æ­¥å¤„ç†ï¼Œé¿å…é˜»å¡UI

### 4. å®ç°ç»†èŠ‚

#### æœç´¢å‘½ä»¤æ³¨å†Œ

åœ¨ `package.json` ä¸­æ·»åŠ å‘½ä»¤ï¼š
```json
{
  "command": "secretStatusBar.search",
  "title": "æœç´¢å†…å®¹",
  "category": "æ§åˆ¶æ é˜…è¯»"
}
```

#### æœç´¢æµç¨‹

1. **æ£€æŸ¥å†…å®¹æ˜¯å¦å·²åŠ è½½**
   ```typescript
   if (!currentContent || currentPages.length === 0) {
       await loadAndUpdate();
   }
   ```

2. **è¾“å…¥æœç´¢å…³é”®è¯**
   ```typescript
   const searchText = await vscode.window.showInputBox({
       prompt: 'è¯·è¾“å…¥è¦æœç´¢çš„å†…å®¹',
       placeHolder: 'æœç´¢å…³é”®è¯...'
   });
   ```

3. **æ‰§è¡Œæœç´¢**
   ```typescript
   const cleanedContent = cleanTextContent(currentContent);
   const matches = searchContent(cleanedContent, searchText, currentPages, pageSize);
   ```

4. **å¤„ç†æœç´¢ç»“æœ**
   ```typescript
   if (matches.length === 0) {
       vscode.window.showInformationMessage('æœªæ‰¾åˆ°åŒ¹é…å†…å®¹');
   } else if (matches.length === 1) {
       // ç›´æ¥è·³è½¬
       await jumpToPage(matches[0].page, filePath, context);
   } else {
       // æ˜¾ç¤ºé€‰æ‹©åˆ—è¡¨
       const selected = await vscode.window.showQuickPick(items);
       if (selected) {
           await jumpToPage(selected.match.page, filePath, context);
       }
   }
   ```

#### é¡µé¢è·³è½¬å®ç°

```typescript
async function jumpToPage(
    targetPage: number,
    filePath: string,
    context: vscode.ExtensionContext
) {
    // ç¡®ä¿æ˜¾ç¤ºçœŸå®å†…å®¹
    if (!showRealContent) {
        showRealContent = true;
    }
    
    // æ›´æ–°é˜…è¯»çŠ¶æ€
    const enableCache = await getConfigValue('enableCache', true, context);
    if (enableCache) {
        saveReadingState(context, {
            currentPage: targetPage,
            currentFile: filePath,
            lastUpdateTime: Date.now()
        });
    }
    
    // æ›´æ–°çŠ¶æ€æ 
    const pageContent = currentPages[targetPage] || '';
    await updateStatusBar(
        statusBarItem,
        pageContent,
        filePath,
        targetPage,
        currentPages.length,
        showRealContent,
        context
    );
    
    // æ˜¾ç¤ºæç¤º
    vscode.window.showInformationMessage(
        `å·²è·³è½¬åˆ°ç¬¬ ${targetPage + 1} é¡µï¼ˆå…± ${currentPages.length} é¡µï¼‰`
    );
}
```

### 5. ç”¨æˆ·ä½“éªŒè®¾è®¡

#### æœç´¢å…¥å£
- **å‘½ä»¤é¢æ¿**ï¼š`æ§åˆ¶æ é˜…è¯»: æœç´¢å†…å®¹`
- **å¿«æ·é”®**ï¼ˆå¯é€‰ï¼‰ï¼š`Ctrl+Shift+F` (Mac: `Cmd+Shift+F`)

#### æœç´¢é€‰é¡¹ï¼ˆå¯é€‰æ‰©å±•ï¼‰
- å¤§å°å†™æ•æ„Ÿ/ä¸æ•æ„Ÿ
- å…¨è¯åŒ¹é…
- æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒ

#### ç»“æœæ˜¾ç¤º
- **å•ä¸ªåŒ¹é…**ï¼šç›´æ¥è·³è½¬ + æç¤ºä¿¡æ¯
- **å¤šä¸ªåŒ¹é…**ï¼šé€‰æ‹©åˆ—è¡¨ï¼Œæ˜¾ç¤ºï¼š
  - é¡µé¢ä¿¡æ¯ï¼š`ç¬¬ X é¡µ / å…± Y é¡µ`
  - ä¸Šä¸‹æ–‡é¢„è§ˆï¼šåŒ¹é…å‰åå„20å­—ç¬¦
  - åŒ¹é…ä½ç½®ï¼šåœ¨é¡µé¢ä¸­çš„å¤§è‡´ä½ç½®

### 6. è¾¹ç•Œæƒ…å†µå¤„ç†

#### æƒ…å†µ1: æœªåŠ è½½å†…å®¹
- è‡ªåŠ¨è°ƒç”¨ `loadAndUpdate()` åŠ è½½å†…å®¹

#### æƒ…å†µ2: æœç´¢å…³é”®è¯ä¸ºç©º
- æç¤ºç”¨æˆ·è¾“å…¥æœ‰æ•ˆå…³é”®è¯

#### æƒ…å†µ3: æ— åŒ¹é…ç»“æœ
- æ˜¾ç¤ºå‹å¥½æç¤ºï¼š"æœªæ‰¾åˆ°åŒ¹é…å†…å®¹"

#### æƒ…å†µ4: åŒ¹é…å†…å®¹è·¨é¡µ
- è·³è½¬åˆ°åŒ¹é…çš„èµ·å§‹é¡µé¢

#### æƒ…å†µ5: æœç´¢æ—¶å†…å®¹å·²æ›´æ–°
- é‡æ–°æœç´¢æœ€æ–°å†…å®¹

## ğŸ“Š å®ç°ä¼˜å…ˆçº§

### ç¬¬ä¸€é˜¶æ®µï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. âœ… åŸºç¡€æœç´¢åŠŸèƒ½
2. âœ… å•åŒ¹é…ç›´æ¥è·³è½¬
3. âœ… å¤šåŒ¹é…é€‰æ‹©åˆ—è¡¨
4. âœ… é¡µé¢è·³è½¬å®ç°

### ç¬¬äºŒé˜¶æ®µï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰
1. æœç´¢é€‰é¡¹ï¼ˆå¤§å°å†™ã€å…¨è¯åŒ¹é…ï¼‰
2. æœç´¢ç»“æœé«˜äº®
3. æœç´¢å†å²è®°å½•
4. å¿«æ·é”®æ”¯æŒ

## âœ… ç»“è®º

**æŠ€æœ¯å¯è¡Œæ€§ï¼šâœ… å®Œå…¨å¯è¡Œ**

1. **ç°æœ‰åŸºç¡€å®Œå–„**ï¼šåˆ†é¡µã€è·³è½¬ã€çŠ¶æ€ç®¡ç†éƒ½å·²å®ç°
2. **APIæ”¯æŒå……åˆ†**ï¼šVS Codeæä¾›äº†æ‰€éœ€çš„æ‰€æœ‰API
3. **å®ç°éš¾åº¦é€‚ä¸­**ï¼šä¸»è¦æ˜¯ç®—æ³•é€»è¾‘ï¼Œæ— æŠ€æœ¯éšœç¢
4. **ç”¨æˆ·ä½“éªŒè‰¯å¥½**ï¼šå¯ä»¥è®¾è®¡ç›´è§‚çš„æœç´¢å’Œé€‰æ‹©ç•Œé¢

**å»ºè®®**ï¼šå¯ä»¥ç«‹å³å¼€å§‹å®ç°ï¼Œé¢„è®¡å®ç°æ—¶é—´ï¼š2-3å°æ—¶

## ğŸ”§ å®ç°æ­¥éª¤å»ºè®®

1. **ç¬¬ä¸€æ­¥**ï¼šå®ç°åŸºç¡€æœç´¢å‡½æ•° `searchContent()`
2. **ç¬¬äºŒæ­¥**ï¼šå®ç°é¡µé¢è®¡ç®—å‡½æ•° `calculatePageForPosition()`
3. **ç¬¬ä¸‰æ­¥**ï¼šå®ç°è·³è½¬å‡½æ•° `jumpToPage()`
4. **ç¬¬å››æ­¥**ï¼šæ³¨å†Œæœç´¢å‘½ä»¤å¹¶å®ç°å®Œæ•´æµç¨‹
5. **ç¬¬äº”æ­¥**ï¼šæµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ
6. **ç¬¬å…­æ­¥**ï¼šä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼ˆå¯é€‰ï¼‰

